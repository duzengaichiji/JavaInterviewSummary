 # Atomic类型和CAS自旋锁
 ----------
- 原子类型
> AtomicInteger,AtomicLong等是并发包提供的在并发情况下具有**原子性**的变量；
> 
> 它们的getAndIncre等原子性的方法，实现原理是CAS自选锁

- 自旋锁和重量级锁（sychronized)
> 通常来说，自旋锁(CAS)不用进入内核态，而重量级锁造成的阻塞需要进入内核态，这意味着自旋锁可以避免一些线程切换的开销；
> 
> 自旋锁通过CAS即compareAndSet方法实现；
> 
> compareAndSet(T 预期值，T 目标值)
> 
> 其操作是比较线程的工作内存（Cache）中的变量值和内存中的值（预期值）是否相等，如果是，则将它更新为目标值并返回true，如果不是，则说明它被修改了，返回false；
> 

> CAS机制的问题主要有三点：
> 
> 1.自旋机制需要一直读取内存中的变量并进行比较，本身是一种开销；
> 
> 2.只能作用于一个变量，只能保证一个变量的原子性；
> 
> 3.ABA问题，假如线程1从内存中取出变量A；线程2从也取出变量A，将其值修改为B后，又替换回变量A；而此时线程1读到的还是变量A，并没有感知到线程2进行过修改；
> 
> （ABA解决方法，有带版本号的原子类型）